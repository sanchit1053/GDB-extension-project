<!DOCTYPE html>
<html lang="en">

    <head>
        <title>Graph Visualizer</title>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/2.29.4/js/jquery.terminal.min.js"></script> 
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery.terminal/2.29.4/css/jquery.terminal.min.css" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.19.1/cytoscape.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/dagre/0.8.5/dagre.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/cytoscape-dagre@2.2.2/cytoscape-dagre.min.js"></script>
        
        <style>
            #cy {
        width: 50%;
        height: 400px;
        position: absolute;
        top: 50px;
        left: 10px;
        border-style: solid;
        border-color: black;
    }

        #terminal{
          width: 50%;
          height: 400px;
          top: 50px;
          position: absolute;
          left: 52%;
        }
    </style>
    </head>
    
    <body> 
      <div id="cy" ></div>
      <div id="terminal"></div> 
      <!-- <form action="/" method = "post">
        command <input type = "text" name = "cmd" >
        <input type = "submit" value = "Submit" >
      </form>
      {% for r in response %}
        {%if r['type'] == 'output'%} 
          {{r['payload']}} <br>
        {%endif%}
        {%if r['type'] == 'console'%} 
          {{r['payload']}} <br>
        {%endif%}
      {%endfor%}
      <br> -->

      <a href="\upload-file">Go to Uploads Page</a>

      <script>
      $(document).ready(function(){
     
        $('#terminal').terminal(function(command,term){
          $.post('/', {cmd: command}).then(function(r){
            console.log(r.response);
            for (let a in r.response){
                if(r.response[a].type == 'console'){
                  console.log("Hello");
                  term.echo(r.response[a].payload);
                }
            }
            var data = JSON.stringify(r.data);
            var cy = cytoscape({
           // container: document.getElementById('cy'),
            container: $('#cy'),

        layout: {
          name: 'dagre',
          rankDir: 'LR'
        },
            style: [
        {
            selector: 'node',
            style: {
                shape: 'hexagon',
                'background-color': 'data(color)',
                label: 'data(id)'
              }
        }],
        elements:  JSON.parse(data)
          });
            function updateDiv() {$("#cy").load(location.href + " #cy") };
          });
        },{
          greetings: 'Welcome to the GDB Graph visualizer by Team Terminal Stack'
        });

     });
     </script>


    <script>
        

        var data = '{{ data |tojson }}'; 
        var cy = cytoscape({
           // container: document.getElementById('cy'),
            container: $('#cy'),

        layout: {
          name: 'dagre',
          rankDir: 'LR'
        },
            style: [
        {
            selector: 'node',
            style: {
                shape: 'hexagon',
                'background-color': 'data(color)',
                label: 'data(id)'
              }
        }],
        elements:  JSON.parse(data)
          });
        </script>
    </body>
</html>